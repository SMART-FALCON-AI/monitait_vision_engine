// ===== Internationalization (i18n) System =====
var currentLang = localStorage.getItem('monitaqc_lang') || 'en';

var translations = {
    en: {
        // Tabs
        tab_dashboard: "Dashboard", tab_ai: "AI Assistant", tab_gallery: "Gallery",
        tab_charts: "Charts", tab_hardware: "Hardware", tab_cameras: "Cameras",
        tab_inference: "Inference", tab_advanced: "Advanced",
        // Header
        save_all: "Save All Configuration", last_saved: "Last:", never: "Never",
        // Dashboard
        shipment: "Shipment", status: "Status", encoder: "Encoder", speed: "Speed",
        movement: "Movement", ej_queue: "Ej Queue", ej_active: "Ej Active",
        ej_enable: "Ej Enable", ej_offset: "Ej Offset",
        ok: "OK", ng: "NG", downtime: "Downtime", analog: "Analog",
        power: "Power", capture: "Capture", inference: "Inference",
        checking: "Checking...", online: "Online", offline: "Offline",
        moving: "Moving", stopped: "Stopped", enabled: "Enabled", disabled: "Disabled",
        // Timeline
        first: "First", previous: "Previous", next: "Next", last: "Last",
        zoom_in: "Zoom In", reset_zoom: "Reset Zoom", zoom_out: "Zoom Out",
        stop_update: "Stop Auto-Update", resume_update: "Resume Auto-Update",
        no_frames: "No frames yet",
        // Cameras
        camera_discovery: "IP Camera Discovery", network_subnet: "Network Subnet (first 3 octets)",
        scan_network: "Scan Network", camera_preview: "Camera Preview",
        camera_name: "Camera Name (optional)", camera_monitoring: "Camera Monitoring",
        refresh: "Refresh", apply: "Apply", save: "Save", delete: "Delete",
        // Image Processing
        image_processing: "Image Processing Configuration",
        parent_objects: "Parent Object List", remove_raw: "Remove Raw Image After DM Decode",
        // DataMatrix
        dm_config: "DataMatrix Configuration", valid_dm_sizes: "Valid DM Char Sizes",
        confidence_threshold: "Confidence Threshold", overlap_threshold: "Overlap Threshold",
        // Features
        histogram_feature: "Histogram Feature", save_histogram: "Save Histogram Images",
        class_count_check: "Class Count Check", classes_to_check: "Classes to Check",
        class_confidence: "Class Count Confidence Threshold",
        light_status: "Light Status Check",
        // State Management
        state_management: "State Management (Camera Capture Control)",
        trigger_capture: "Trigger Capture", available_states: "Available States",
        create_edit_state: "Create/Edit State (Multi-Phase Capture)",
        state_name: "State Name", delay: "Delay (s)", cameras: "Cameras",
        // Hardware
        hardware_config: "Hardware Configuration",
        status_indicators: "Status Indicators", basic_controls: "Basic Controls",
        upper_pwm: "Upper PWM Value (0-255)", bottom_pwm: "Bottom PWM Value (0-255)",
        warning_led: "Warning LED",
        ok_config: "OK Configuration", ng_config: "NG Configuration",
        ok_counter_adj: "OK Counter Adjustment", ng_counter_adj: "NG Counter Adjustment",
        offset_delay: "Offset Delay (milliseconds)", duration_pulses: "Duration Pulses (16us each)",
        duration_percent: "Duration Percent", encoder_factor: "Encoder Factor",
        set: "Set", adjust: "Adjust",
        // Counter Service
        counter_service_config: "Counter Service Configuration",
        ejector_enabled: "Ejector Enabled", ejector_offset: "Ejector Offset (encoder counts)",
        ejector_duration: "Ejector Duration (seconds)", ejector_poll: "Ejector Poll Interval (seconds)",
        time_between: "Time Between Packages (seconds)",
        capture_mode: "Capture Mode",
        // Serial Port
        serial_config: "Serial Port Configuration", serial_port: "Serial Port Device",
        baud_rate: "Baud Rate", serial_mode: "Serial Mode",
        auto_apply_serial: "Auto-Apply: Serial port settings are applied immediately when changed",
        // Watcher
        watcher_config: "Watcher Configuration",
        downtime_threshold: "Downtime Threshold (seconds)",
        external_reset: "External Reset", verbose_mode: "Verbose Mode",
        ascending: "Ascending (1→2→3...)", descending: "Descending (...3→2→1)", image_rotation: "Image Rotation",
        // Inference
        inference_status: "Inference Status", pipeline: "Pipeline",
        pipeline_management: "Inference Pipeline Management",
        active_pipeline: "Active Pipeline", pipeline_config: "Pipeline Configuration",
        available_pipelines: "Available Pipelines",
        create_edit_pipeline: "Create/Edit Pipeline",
        pipeline_name: "Pipeline Name", description: "Description",
        models_in_pipeline: "Models in Pipeline", create_update: "Create/Update",
        inference_models: "Inference Models", create_edit_model: "Create/Edit Model",
        model_name: "Model Name", type: "Type", inference_url: "Inference URL",
        fetch_models: "Fetch Models", min_confidence: "Min Confidence",
        // Advanced
        timeline_config: "Timeline Configuration",
        show_bboxes: "Show Bounding Boxes", camera_order: "Camera Order (Columns)",
        image_quality: "Image Quality", rows_per_page: "Rows per Page",
        total_frames: "Total Frames Stored",
        apply_timeline: "Apply Timeline Configuration",
        redis_config: "Redis Configuration", redis_host: "Redis Host", redis_port: "Redis Port",
        ai_config: "AI Configuration", active_model: "Active Model",
        configured_models: "Configured Models", add_edit_model: "Add / Edit Model",
        provider: "Provider", api_key: "API Key", save_model: "Save Model", clear: "Clear",
        get_api_key: "Get API Key",
        db_config: "Database Configuration", active_profile: "Active Profile",
        configured_profiles: "Configured Profiles", add_edit_profile: "Add / Edit Profile",
        profile_name: "Profile Name", host: "Host", port: "Port", database: "Database",
        user: "User", password: "Password", save_profile: "Save Profile",
        audio_config: "Audio Alerts Configuration",
        voice_narration: "Enable Voice Narration", beep_sounds: "Enable Beep Sounds",
        volume: "Volume", test_audio: "Test Audio",
        per_object: "Per-Object Configuration", enable_all: "Enable All",
        db_storage: "Database Storage Configuration",
        store_annotations: "Store Annotations to Database",
        // Charts
        grafana_dashboard: "Grafana Dashboard",
        default_creds: "Default Credentials",
        connection_info: "TimescaleDB Connection",
        // Features
        feature_toggles: "Feature Toggles",
        // Language
        language: "Language"
    },
    fa: {
        tab_dashboard: "داشبورد", tab_ai: "دستیار هوشمند", tab_gallery: "گالری",
        tab_charts: "نمودارها", tab_hardware: "سخت‌افزار", tab_cameras: "دوربین‌ها",
        tab_inference: "استنتاج", tab_advanced: "پیشرفته",
        save_all: "ذخیره تمام تنظیمات", last_saved: "آخرین:", never: "هرگز",
        shipment: "محموله", status: "وضعیت", encoder: "انکودر", speed: "سرعت",
        movement: "حرکت", ej_queue: "صف خروج", ej_active: "خروجی فعال",
        ej_enable: "خروجی", ej_offset: "آفست خروجی",
        ok: "سالم", ng: "معیوب", downtime: "توقف", analog: "آنالوگ",
        power: "برق", capture: "ثبت", inference: "استنتاج",
        checking: "در حال بررسی...", online: "آنلاین", offline: "آفلاین",
        moving: "در حال حرکت", stopped: "متوقف", enabled: "فعال", disabled: "غیرفعال",
        first: "اول", previous: "قبلی", next: "بعدی", last: "آخر",
        zoom_in: "بزرگنمایی", reset_zoom: "بازنشانی", zoom_out: "کوچکنمایی",
        stop_update: "توقف بروزرسانی", resume_update: "ادامه بروزرسانی",
        no_frames: "هنوز فریمی نیست",
        camera_discovery: "جستجوی دوربین IP", network_subnet: "زیرشبکه (۳ اکتت اول)",
        scan_network: "اسکن شبکه", camera_preview: "پیش‌نمایش دوربین",
        camera_name: "نام دوربین (اختیاری)", camera_monitoring: "مانیتورینگ دوربین",
        refresh: "بروزرسانی", apply: "اعمال", save: "ذخیره", delete: "حذف",
        image_processing: "تنظیمات پردازش تصویر",
        parent_objects: "لیست اشیاء والد", remove_raw: "حذف تصویر خام بعد از دیکد",
        dm_config: "تنظیمات DataMatrix", valid_dm_sizes: "اندازه‌های معتبر DM",
        confidence_threshold: "آستانه اطمینان", overlap_threshold: "آستانه همپوشانی",
        histogram_feature: "ویژگی هیستوگرام", save_histogram: "ذخیره تصاویر هیستوگرام",
        class_count_check: "بررسی تعداد کلاس", classes_to_check: "کلاس‌های مورد بررسی",
        class_confidence: "آستانه اطمینان تعداد کلاس",
        light_status: "بررسی وضعیت نور",
        feature_toggles: "تنظیمات ویژگی‌ها",
        state_management: "مدیریت وضعیت (کنترل ثبت دوربین)",
        trigger_capture: "شروع ثبت", available_states: "وضعیت‌های موجود",
        create_edit_state: "ایجاد/ویرایش وضعیت (ثبت چندمرحله‌ای)",
        state_name: "نام وضعیت", delay: "تاخیر (ثانیه)", cameras: "دوربین‌ها",
        hardware_config: "تنظیمات سخت‌افزار",
        status_indicators: "نشانگرهای وضعیت", basic_controls: "کنترل‌های پایه",
        upper_pwm: "مقدار PWM بالا (0-255)", bottom_pwm: "مقدار PWM پایین (0-255)",
        warning_led: "LED هشدار",
        ok_config: "تنظیمات سالم", ng_config: "تنظیمات معیوب",
        ok_counter_adj: "تنظیم شمارنده سالم", ng_counter_adj: "تنظیم شمارنده معیوب",
        offset_delay: "تاخیر آفست (میلی‌ثانیه)", duration_pulses: "مدت پالس (16 میکروثانیه)",
        duration_percent: "درصد مدت", encoder_factor: "ضریب انکودر",
        set: "تنظیم", adjust: "تنظیم",
        counter_service_config: "تنظیمات سرویس شمارنده",
        ejector_enabled: "خروجی فعال", ejector_offset: "آفست خروجی (شمارش انکودر)",
        ejector_duration: "مدت خروجی (ثانیه)", ejector_poll: "فاصله نظرسنجی خروجی (ثانیه)",
        time_between: "زمان بین بسته‌ها (ثانیه)", capture_mode: "حالت ثبت",
        serial_config: "تنظیمات پورت سریال", serial_port: "دستگاه پورت سریال",
        baud_rate: "نرخ بود", serial_mode: "حالت سریال",
        auto_apply_serial: "اعمال خودکار: تنظیمات پورت سریال فوری اعمال می‌شوند",
        watcher_config: "تنظیمات ناظر",
        downtime_threshold: "آستانه توقف (ثانیه)",
        external_reset: "ریست خارجی", verbose_mode: "حالت تفصیلی",
        ascending: "صعودی (۱→۲→۳...)", descending: "نزولی (...۳→۲→۱)", image_rotation: "چرخش تصویر",
        inference_status: "وضعیت استنتاج", pipeline: "خط لوله",
        pipeline_management: "مدیریت خط لوله استنتاج",
        active_pipeline: "خط لوله فعال", pipeline_config: "تنظیمات خط لوله",
        available_pipelines: "خطوط لوله موجود",
        create_edit_pipeline: "ایجاد/ویرایش خط لوله",
        pipeline_name: "نام خط لوله", description: "توضیحات",
        models_in_pipeline: "مدل‌ها در خط لوله", create_update: "ایجاد/بروزرسانی",
        inference_models: "مدل‌های استنتاج", create_edit_model: "ایجاد/ویرایش مدل",
        model_name: "نام مدل", type: "نوع", inference_url: "آدرس استنتاج",
        fetch_models: "دریافت مدل‌ها", min_confidence: "حداقل اطمینان",
        timeline_config: "تنظیمات تایم‌لاین",
        show_bboxes: "نمایش جعبه‌های مرزی", camera_order: "ترتیب دوربین (ستون‌ها)",
        image_quality: "کیفیت تصویر", rows_per_page: "ردیف در هر صفحه",
        total_frames: "کل فریم‌های ذخیره شده",
        apply_timeline: "اعمال تنظیمات تایم‌لاین",
        redis_config: "تنظیمات Redis", redis_host: "هاست Redis", redis_port: "پورت Redis",
        ai_config: "تنظیمات هوش مصنوعی", active_model: "مدل فعال",
        configured_models: "مدل‌های تنظیم شده", add_edit_model: "افزودن / ویرایش مدل",
        provider: "ارائه‌دهنده", api_key: "کلید API", save_model: "ذخیره مدل", clear: "پاک کردن",
        get_api_key: "دریافت کلید API",
        db_config: "تنظیمات پایگاه داده", active_profile: "پروفایل فعال",
        configured_profiles: "پروفایل‌های تنظیم شده", add_edit_profile: "افزودن / ویرایش پروفایل",
        profile_name: "نام پروفایل", host: "هاست", port: "پورت", database: "پایگاه داده",
        user: "کاربر", password: "رمز عبور", save_profile: "ذخیره پروفایل",
        audio_config: "تنظیمات هشدار صوتی",
        voice_narration: "فعال‌سازی روایت صوتی", beep_sounds: "فعال‌سازی صدای بیپ",
        volume: "حجم صدا", test_audio: "تست صدا",
        per_object: "تنظیمات هر شیء", enable_all: "فعال‌سازی همه",
        db_storage: "تنظیمات ذخیره‌سازی پایگاه داده",
        store_annotations: "ذخیره حاشیه‌نویسی در پایگاه داده",
        grafana_dashboard: "داشبورد Grafana",
        default_creds: "اطلاعات ورود پیش‌فرض",
        connection_info: "اتصال TimescaleDB",
        language: "زبان"
    },
    ar: {
        tab_dashboard: "لوحة التحكم", tab_ai: "مساعد ذكي", tab_gallery: "معرض",
        tab_charts: "رسوم بيانية", tab_hardware: "أجهزة", tab_cameras: "كاميرات",
        tab_inference: "استدلال", tab_advanced: "متقدم",
        save_all: "حفظ جميع الإعدادات", last_saved: "آخر:", never: "أبداً",
        shipment: "شحنة", status: "الحالة", encoder: "المشفر", speed: "السرعة",
        movement: "الحركة", ej_queue: "طابور الطرد", ej_active: "الطرد نشط",
        ej_enable: "تفعيل الطرد", ej_offset: "إزاحة الطرد",
        ok: "سليم", ng: "معيب", downtime: "توقف", analog: "تناظري",
        power: "الطاقة", capture: "التقاط", inference: "استدلال",
        checking: "جاري الفحص...", online: "متصل", offline: "غير متصل",
        moving: "متحرك", stopped: "متوقف", enabled: "مفعل", disabled: "معطل",
        first: "الأول", previous: "السابق", next: "التالي", last: "الأخير",
        zoom_in: "تكبير", reset_zoom: "إعادة تعيين", zoom_out: "تصغير",
        stop_update: "إيقاف التحديث", resume_update: "استئناف التحديث",
        no_frames: "لا توجد إطارات بعد",
        camera_discovery: "اكتشاف كاميرا IP", network_subnet: "الشبكة الفرعية",
        scan_network: "مسح الشبكة", camera_preview: "معاينة الكاميرا",
        camera_name: "اسم الكاميرا (اختياري)", camera_monitoring: "مراقبة الكاميرا",
        refresh: "تحديث", apply: "تطبيق", save: "حفظ", delete: "حذف",
        image_processing: "إعدادات معالجة الصور",
        parent_objects: "قائمة الكائنات الأصلية", remove_raw: "حذف الصورة الخام بعد الفك",
        dm_config: "إعدادات DataMatrix", valid_dm_sizes: "أحجام DM الصالحة",
        confidence_threshold: "عتبة الثقة", overlap_threshold: "عتبة التداخل",
        histogram_feature: "ميزة الرسم البياني", save_histogram: "حفظ صور الرسم البياني",
        class_count_check: "فحص عدد الفئات", classes_to_check: "الفئات المراد فحصها",
        class_confidence: "عتبة ثقة عدد الفئات", light_status: "فحص حالة الضوء",
        feature_toggles: "إعدادات الميزات",
        state_management: "إدارة الحالة (التحكم بالتقاط الكاميرا)",
        trigger_capture: "بدء الالتقاط", available_states: "الحالات المتاحة",
        create_edit_state: "إنشاء/تحرير حالة", state_name: "اسم الحالة",
        delay: "تأخير (ثانية)", cameras: "كاميرات",
        hardware_config: "إعدادات الأجهزة",
        status_indicators: "مؤشرات الحالة", basic_controls: "التحكم الأساسي",
        upper_pwm: "قيمة PWM العلوي (0-255)", bottom_pwm: "قيمة PWM السفلي (0-255)",
        warning_led: "LED التحذير",
        ok_config: "إعدادات السليم", ng_config: "إعدادات المعيب",
        ok_counter_adj: "ضبط عداد السليم", ng_counter_adj: "ضبط عداد المعيب",
        offset_delay: "تأخير الإزاحة (مللي ثانية)", duration_pulses: "نبضات المدة (16 مايكروثانية)",
        duration_percent: "نسبة المدة", encoder_factor: "معامل المشفر",
        set: "تعيين", adjust: "ضبط",
        counter_service_config: "إعدادات خدمة العداد",
        ejector_enabled: "الطارد مفعل", ejector_offset: "إزاحة الطارد",
        ejector_duration: "مدة الطارد (ثانية)", ejector_poll: "فاصل استقصاء الطارد",
        time_between: "الوقت بين الحزم (ثانية)", capture_mode: "وضع الالتقاط",
        serial_config: "إعدادات المنفذ التسلسلي", serial_port: "جهاز المنفذ",
        baud_rate: "معدل البود", serial_mode: "وضع المنفذ",
        auto_apply_serial: "تطبيق تلقائي: يتم تطبيق إعدادات المنفذ فوراً",
        watcher_config: "إعدادات المراقب",
        downtime_threshold: "عتبة التوقف (ثانية)",
        external_reset: "إعادة تعيين خارجي", verbose_mode: "الوضع التفصيلي",
        ascending: "تصاعدي (١→٢→٣...)", descending: "تنازلي (...٣→٢→١)", image_rotation: "تدوير الصورة",
        inference_status: "حالة الاستدلال", pipeline: "خط الأنابيب",
        pipeline_management: "إدارة خطوط الاستدلال",
        active_pipeline: "خط الأنابيب النشط", pipeline_config: "إعدادات خط الأنابيب",
        available_pipelines: "الخطوط المتاحة",
        create_edit_pipeline: "إنشاء/تحرير خط", pipeline_name: "اسم الخط",
        description: "الوصف", models_in_pipeline: "نماذج في الخط",
        create_update: "إنشاء/تحديث",
        inference_models: "نماذج الاستدلال", create_edit_model: "إنشاء/تحرير نموذج",
        model_name: "اسم النموذج", type: "النوع", inference_url: "عنوان الاستدلال",
        fetch_models: "جلب النماذج", min_confidence: "الحد الأدنى للثقة",
        timeline_config: "إعدادات الجدول الزمني",
        show_bboxes: "إظهار المربعات المحيطة", camera_order: "ترتيب الكاميرا",
        image_quality: "جودة الصورة", rows_per_page: "صفوف في الصفحة",
        total_frames: "إجمالي الإطارات المخزنة",
        apply_timeline: "تطبيق إعدادات الجدول",
        redis_config: "إعدادات Redis", redis_host: "مضيف Redis", redis_port: "منفذ Redis",
        ai_config: "إعدادات الذكاء الاصطناعي", active_model: "النموذج النشط",
        configured_models: "النماذج المهيأة", add_edit_model: "إضافة / تحرير نموذج",
        provider: "المزود", api_key: "مفتاح API", save_model: "حفظ النموذج", clear: "مسح",
        get_api_key: "الحصول على مفتاح API",
        db_config: "إعدادات قاعدة البيانات", active_profile: "الملف النشط",
        configured_profiles: "الملفات المهيأة", add_edit_profile: "إضافة / تحرير ملف",
        profile_name: "اسم الملف", host: "المضيف", port: "المنفذ", database: "قاعدة البيانات",
        user: "المستخدم", password: "كلمة المرور", save_profile: "حفظ الملف",
        audio_config: "إعدادات التنبيهات الصوتية",
        voice_narration: "تفعيل السرد الصوتي", beep_sounds: "تفعيل أصوات التنبيه",
        volume: "مستوى الصوت", test_audio: "اختبار الصوت",
        per_object: "إعدادات كل كائن", enable_all: "تفعيل الكل",
        db_storage: "إعدادات تخزين قاعدة البيانات",
        store_annotations: "تخزين التعليقات في قاعدة البيانات",
        grafana_dashboard: "لوحة Grafana", default_creds: "بيانات الدخول الافتراضية",
        connection_info: "اتصال TimescaleDB", language: "اللغة"
    },
    de: {
        tab_dashboard: "Dashboard", tab_ai: "KI-Assistent", tab_gallery: "Galerie",
        tab_charts: "Diagramme", tab_hardware: "Hardware", tab_cameras: "Kameras",
        tab_inference: "Inferenz", tab_advanced: "Erweitert",
        save_all: "Alle Einstellungen speichern", last_saved: "Zuletzt:", never: "Nie",
        shipment: "Sendung", status: "Status", encoder: "Encoder", speed: "Geschwindigkeit",
        movement: "Bewegung", ej_queue: "Ausw. Warteschlange", ej_active: "Ausw. Aktiv",
        ej_enable: "Auswerfer", ej_offset: "Ausw. Offset",
        ok: "OK", ng: "Fehler", downtime: "Stillstand", analog: "Analog",
        power: "Strom", capture: "Erfassung", inference: "Inferenz",
        checking: "Prüfe...", online: "Online", offline: "Offline",
        moving: "Bewegend", stopped: "Gestoppt", enabled: "Aktiviert", disabled: "Deaktiviert",
        first: "Erste", previous: "Zurück", next: "Weiter", last: "Letzte",
        zoom_in: "Vergrößern", reset_zoom: "Zurücksetzen", zoom_out: "Verkleinern",
        stop_update: "Update stoppen", resume_update: "Update fortsetzen",
        no_frames: "Noch keine Frames",
        camera_discovery: "IP-Kamera Erkennung", network_subnet: "Netzwerk-Subnetz",
        scan_network: "Netzwerk scannen", camera_preview: "Kamera-Vorschau",
        camera_name: "Kameraname (optional)", camera_monitoring: "Kamera-Überwachung",
        refresh: "Aktualisieren", apply: "Anwenden", save: "Speichern", delete: "Löschen",
        image_processing: "Bildverarbeitungseinstellungen",
        parent_objects: "Elternobjektliste", remove_raw: "Rohbild nach DM-Dekodierung löschen",
        dm_config: "DataMatrix-Konfiguration", valid_dm_sizes: "Gültige DM-Größen",
        confidence_threshold: "Konfidenzschwelle", overlap_threshold: "Überlappungsschwelle",
        histogram_feature: "Histogramm-Funktion", save_histogram: "Histogrammbilder speichern",
        class_count_check: "Klassenanzahl-Prüfung", classes_to_check: "Zu prüfende Klassen",
        class_confidence: "Klassenanzahl-Konfidenzschwelle", light_status: "Lichtstatus-Prüfung",
        state_management: "Zustandsverwaltung (Kamera-Erfassungssteuerung)",
        trigger_capture: "Erfassung auslösen", available_states: "Verfügbare Zustände",
        create_edit_state: "Zustand erstellen/bearbeiten", state_name: "Zustandsname",
        delay: "Verzögerung (s)", cameras: "Kameras",
        hardware_config: "Hardware-Konfiguration",
        status_indicators: "Statusanzeigen", basic_controls: "Grundsteuerung",
        upper_pwm: "Oberer PWM-Wert (0-255)", bottom_pwm: "Unterer PWM-Wert (0-255)",
        warning_led: "Warn-LED",
        ok_config: "OK-Konfiguration", ng_config: "Fehler-Konfiguration",
        ok_counter_adj: "OK-Zähler Einstellung", ng_counter_adj: "Fehler-Zähler Einstellung",
        offset_delay: "Offset-Verzögerung (ms)", duration_pulses: "Dauerimpulse (16µs je)",
        duration_percent: "Dauer-Prozent", encoder_factor: "Encoder-Faktor",
        set: "Setzen", adjust: "Anpassen",
        counter_service_config: "Zählerservice-Konfiguration",
        ejector_enabled: "Auswerfer aktiv", ejector_offset: "Auswerfer-Offset",
        ejector_duration: "Auswerfer-Dauer (s)", ejector_poll: "Auswerfer-Abfrageintervall",
        time_between: "Zeit zwischen Paketen (s)", capture_mode: "Erfassungsmodus",
        serial_config: "Serielle Schnittstelle", serial_port: "Serieller Port",
        baud_rate: "Baudrate", serial_mode: "Serieller Modus",
        auto_apply_serial: "Automatisch: Serielle Einstellungen werden sofort angewendet",
        watcher_config: "Überwachungskonfiguration",
        downtime_threshold: "Stillstandsschwelle (Sekunden)",
        external_reset: "Externer Reset", verbose_mode: "Detaillierter Modus",
        ascending: "Aufsteigend (1→2→3...)", descending: "Absteigend (...3→2→1)", image_rotation: "Bilddrehung",
        inference_status: "Inferenz-Status", pipeline: "Pipeline",
        pipeline_management: "Inferenz-Pipeline-Verwaltung",
        active_pipeline: "Aktive Pipeline", pipeline_config: "Pipeline-Konfiguration",
        available_pipelines: "Verfügbare Pipelines",
        create_edit_pipeline: "Pipeline erstellen/bearbeiten", pipeline_name: "Pipeline-Name",
        description: "Beschreibung", models_in_pipeline: "Modelle in Pipeline",
        create_update: "Erstellen/Aktualisieren",
        inference_models: "Inferenz-Modelle", create_edit_model: "Modell erstellen/bearbeiten",
        model_name: "Modellname", type: "Typ", inference_url: "Inferenz-URL",
        fetch_models: "Modelle abrufen", min_confidence: "Min. Konfidenz",
        timeline_config: "Timeline-Konfiguration",
        show_bboxes: "Begrenzungsrahmen anzeigen", camera_order: "Kamera-Reihenfolge",
        image_quality: "Bildqualität", rows_per_page: "Zeilen pro Seite",
        total_frames: "Gespeicherte Frames gesamt",
        apply_timeline: "Timeline-Konfiguration anwenden",
        redis_config: "Redis-Konfiguration", redis_host: "Redis-Host", redis_port: "Redis-Port",
        ai_config: "KI-Konfiguration", active_model: "Aktives Modell",
        configured_models: "Konfigurierte Modelle", add_edit_model: "Modell hinzufügen/bearbeiten",
        provider: "Anbieter", api_key: "API-Schlüssel", save_model: "Modell speichern", clear: "Löschen",
        get_api_key: "API-Schlüssel erhalten",
        db_config: "Datenbank-Konfiguration", active_profile: "Aktives Profil",
        configured_profiles: "Konfigurierte Profile", add_edit_profile: "Profil hinzufügen/bearbeiten",
        profile_name: "Profilname", host: "Host", port: "Port", database: "Datenbank",
        user: "Benutzer", password: "Passwort", save_profile: "Profil speichern",
        audio_config: "Audio-Alarm-Konfiguration",
        voice_narration: "Sprachausgabe aktivieren", beep_sounds: "Signaltöne aktivieren",
        volume: "Lautstärke", test_audio: "Audio testen",
        per_object: "Objekt-Konfiguration", enable_all: "Alle aktivieren",
        db_storage: "Datenbank-Speicher-Konfiguration",
        store_annotations: "Annotationen in Datenbank speichern",
        grafana_dashboard: "Grafana-Dashboard", default_creds: "Standard-Zugangsdaten",
        connection_info: "TimescaleDB-Verbindung", language: "Sprache"
    },
    tr: {
        tab_dashboard: "Panel", tab_ai: "Yapay Zeka", tab_gallery: "Galeri",
        tab_charts: "Grafikler", tab_hardware: "Donanım", tab_cameras: "Kameralar",
        tab_inference: "Çıkarım", tab_advanced: "Gelişmiş",
        save_all: "Tüm Ayarları Kaydet", last_saved: "Son:", never: "Hiç",
        shipment: "Sevkiyat", status: "Durum", encoder: "Enkoder", speed: "Hız",
        movement: "Hareket", ej_queue: "Atıcı Kuyruk", ej_active: "Atıcı Aktif",
        ej_enable: "Atıcı", ej_offset: "Atıcı Offset",
        ok: "İyi", ng: "Hatalı", downtime: "Duruş", analog: "Analog",
        power: "Güç", capture: "Yakalama", inference: "Çıkarım",
        checking: "Kontrol ediliyor...", online: "Çevrimiçi", offline: "Çevrimdışı",
        moving: "Hareket ediyor", stopped: "Durdu", enabled: "Etkin", disabled: "Devre dışı",
        first: "İlk", previous: "Önceki", next: "Sonraki", last: "Son",
        zoom_in: "Yakınlaştır", reset_zoom: "Sıfırla", zoom_out: "Uzaklaştır",
        stop_update: "Güncellemeyi durdur", resume_update: "Güncellemeye devam",
        no_frames: "Henüz kare yok",
        camera_discovery: "IP Kamera Keşfi", network_subnet: "Ağ Alt Ağı",
        scan_network: "Ağı Tara", camera_preview: "Kamera Önizleme",
        camera_name: "Kamera Adı (isteğe bağlı)", camera_monitoring: "Kamera İzleme",
        refresh: "Yenile", apply: "Uygula", save: "Kaydet", delete: "Sil",
        image_processing: "Görüntü İşleme Ayarları",
        parent_objects: "Ana Nesne Listesi", remove_raw: "DM Çözümlemesinden Sonra Ham Görüntüyü Sil",
        hardware_config: "Donanım Yapılandırması",
        status_indicators: "Durum Göstergeleri", basic_controls: "Temel Kontroller",
        upper_pwm: "Üst PWM Değeri (0-255)", bottom_pwm: "Alt PWM Değeri (0-255)",
        warning_led: "Uyarı LED'i",
        ok_config: "İyi Yapılandırma", ng_config: "Hatalı Yapılandırma",
        ok_counter_adj: "İyi Sayaç Ayarı", ng_counter_adj: "Hatalı Sayaç Ayarı",
        offset_delay: "Offset Gecikmesi (ms)", duration_pulses: "Süre Darbeleri (16µs)",
        duration_percent: "Süre Yüzdesi", encoder_factor: "Enkoder Faktörü",
        set: "Ayarla", adjust: "Ayarla",
        counter_service_config: "Sayaç Servis Yapılandırması",
        ejector_enabled: "Atıcı Etkin", ejector_offset: "Atıcı Offset",
        ejector_duration: "Atıcı Süresi (s)", ejector_poll: "Atıcı Yoklama Aralığı",
        time_between: "Paketler Arası Süre (s)", capture_mode: "Yakalama Modu",
        serial_config: "Seri Port Yapılandırması", serial_port: "Seri Port Cihazı",
        baud_rate: "Baud Hızı", serial_mode: "Seri Mod",
        watcher_config: "İzleyici Yapılandırması",
        downtime_threshold: "Duruş Eşiği (saniye)",
        external_reset: "Harici Sıfırlama", verbose_mode: "Ayrıntılı Mod",
        ascending: "Artan (1→2→3...)", descending: "Azalan (...3→2→1)", image_rotation: "Görüntü Döndürme",
        inference_status: "Çıkarım Durumu", pipeline: "Boru Hattı",
        pipeline_management: "Çıkarım Boru Hattı Yönetimi",
        active_pipeline: "Aktif Boru Hattı",
        inference_models: "Çıkarım Modelleri", model_name: "Model Adı",
        timeline_config: "Zaman Çizelgesi Yapılandırması",
        redis_config: "Redis Yapılandırması",
        ai_config: "Yapay Zeka Yapılandırması",
        db_config: "Veritabanı Yapılandırması",
        audio_config: "Sesli Uyarı Yapılandırması",
        language: "Dil"
    },
    ja: {
        tab_dashboard: "ダッシュボード", tab_ai: "AIアシスタント", tab_gallery: "ギャラリー",
        tab_charts: "チャート", tab_hardware: "ハードウェア", tab_cameras: "カメラ",
        tab_inference: "推論", tab_advanced: "詳細設定",
        save_all: "全設定を保存", last_saved: "最終:", never: "なし",
        shipment: "出荷", status: "状態", encoder: "エンコーダ", speed: "速度",
        movement: "動作", ej_queue: "排出キュー", ej_active: "排出中",
        ej_enable: "排出器", ej_offset: "排出オフセット",
        ok: "良品", ng: "不良", downtime: "停止時間", analog: "アナログ",
        power: "電源", capture: "キャプチャ", inference: "推論",
        checking: "確認中...", online: "オンライン", offline: "オフライン",
        moving: "動作中", stopped: "停止", enabled: "有効", disabled: "無効",
        first: "最初", previous: "前へ", next: "次へ", last: "最後",
        zoom_in: "拡大", reset_zoom: "リセット", zoom_out: "縮小",
        stop_update: "更新停止", resume_update: "更新再開",
        no_frames: "フレームがありません",
        camera_discovery: "IPカメラ検出", scan_network: "ネットワークスキャン",
        camera_monitoring: "カメラ監視",
        refresh: "更新", apply: "適用", save: "保存", delete: "削除",
        hardware_config: "ハードウェア設定",
        status_indicators: "ステータスインジケータ", basic_controls: "基本制御",
        upper_pwm: "上部PWM値 (0-255)", bottom_pwm: "下部PWM値 (0-255)",
        warning_led: "警告LED",
        ok_config: "良品設定", ng_config: "不良設定",
        ok_counter_adj: "良品カウンタ調整", ng_counter_adj: "不良カウンタ調整",
        offset_delay: "オフセット遅延 (ミリ秒)", duration_pulses: "持続パルス (16µs)",
        duration_percent: "持続割合", encoder_factor: "エンコーダ係数",
        set: "設定", adjust: "調整",
        counter_service_config: "カウンタサービス設定",
        ejector_enabled: "排出器有効", ejector_offset: "排出器オフセット",
        ejector_duration: "排出器持続時間 (秒)", ejector_poll: "排出器ポーリング間隔",
        time_between: "パッケージ間時間 (秒)", capture_mode: "キャプチャモード",
        serial_config: "シリアルポート設定", serial_port: "シリアルポートデバイス",
        baud_rate: "ボーレート", serial_mode: "シリアルモード",
        watcher_config: "ウォッチャー設定",
        downtime_threshold: "停止閾値 (秒)",
        external_reset: "外部リセット", verbose_mode: "詳細モード",
        ascending: "昇順 (1→2→3...)", descending: "降順 (...3→2→1)", image_rotation: "画像回転",
        inference_status: "推論状態", pipeline: "パイプライン",
        pipeline_management: "推論パイプライン管理",
        inference_models: "推論モデル", model_name: "モデル名",
        timeline_config: "タイムライン設定",
        redis_config: "Redis設定",
        ai_config: "AI設定", db_config: "データベース設定",
        audio_config: "音声アラート設定",
        language: "言語"
    },
    es: {
        tab_dashboard: "Panel", tab_ai: "Asistente IA", tab_gallery: "Galería",
        tab_charts: "Gráficos", tab_hardware: "Hardware", tab_cameras: "Cámaras",
        tab_inference: "Inferencia", tab_advanced: "Avanzado",
        save_all: "Guardar toda la configuración", last_saved: "Último:", never: "Nunca",
        shipment: "Envío", status: "Estado", encoder: "Codificador", speed: "Velocidad",
        movement: "Movimiento", ej_queue: "Cola eyector", ej_active: "Eyector activo",
        ej_enable: "Eyector", ej_offset: "Offset eyector",
        ok: "OK", ng: "Defecto", downtime: "Inactividad", analog: "Analógico",
        power: "Energía", capture: "Captura", inference: "Inferencia",
        checking: "Verificando...", online: "En línea", offline: "Fuera de línea",
        moving: "En movimiento", stopped: "Detenido", enabled: "Habilitado", disabled: "Deshabilitado",
        first: "Primero", previous: "Anterior", next: "Siguiente", last: "Último",
        zoom_in: "Acercar", reset_zoom: "Restablecer", zoom_out: "Alejar",
        stop_update: "Detener actualización", resume_update: "Reanudar actualización",
        no_frames: "Sin cuadros aún",
        camera_discovery: "Descubrimiento de cámaras IP", scan_network: "Escanear red",
        camera_monitoring: "Monitoreo de cámaras",
        refresh: "Actualizar", apply: "Aplicar", save: "Guardar", delete: "Eliminar",
        hardware_config: "Configuración de hardware",
        status_indicators: "Indicadores de estado", basic_controls: "Controles básicos",
        upper_pwm: "Valor PWM superior (0-255)", bottom_pwm: "Valor PWM inferior (0-255)",
        warning_led: "LED de advertencia",
        ok_config: "Configuración OK", ng_config: "Configuración defectos",
        ok_counter_adj: "Ajuste contador OK", ng_counter_adj: "Ajuste contador defectos",
        offset_delay: "Retardo de offset (ms)", duration_pulses: "Pulsos de duración (16µs)",
        duration_percent: "Porcentaje de duración", encoder_factor: "Factor de codificador",
        set: "Establecer", adjust: "Ajustar",
        counter_service_config: "Configuración del servicio de conteo",
        ejector_enabled: "Eyector habilitado", ejector_offset: "Offset del eyector",
        ejector_duration: "Duración del eyector (s)", ejector_poll: "Intervalo de consulta",
        time_between: "Tiempo entre paquetes (s)", capture_mode: "Modo de captura",
        serial_config: "Configuración de puerto serie", serial_port: "Dispositivo de puerto serie",
        baud_rate: "Velocidad en baudios", serial_mode: "Modo serie",
        watcher_config: "Configuración del vigilante",
        downtime_threshold: "Umbral de inactividad (segundos)",
        external_reset: "Reinicio externo", verbose_mode: "Modo detallado",
        ascending: "Ascendente (1→2→3...)", descending: "Descendente (...3→2→1)", image_rotation: "Rotación de imagen",
        inference_status: "Estado de inferencia", pipeline: "Tubería",
        pipeline_management: "Gestión de tuberías de inferencia",
        inference_models: "Modelos de inferencia", model_name: "Nombre del modelo",
        timeline_config: "Configuración de línea de tiempo",
        redis_config: "Configuración de Redis",
        ai_config: "Configuración de IA", db_config: "Configuración de base de datos",
        audio_config: "Configuración de alertas de audio",
        language: "Idioma"
    }
};

// Get translation with English fallback
function t(key) {
    return (translations[currentLang] && translations[currentLang][key]) || translations.en[key] || key;
}

// Loading state helpers for buttons
function _btnLoading(btn) {
    if (!btn) try { btn = event && event.target && event.target.closest('button, .control-button, .camera-btn, .discovery-button'); } catch(e) {}
    if (!btn || btn.classList.contains('btn-loading')) return null;
    var orig = btn.innerHTML;
    btn.classList.add('btn-loading');
    btn.disabled = true;
    btn.innerHTML = '<span class="btn-spinner"></span>' + orig;
    return { btn: btn, orig: orig };
}
function _btnDone(state) {
    if (!state) return;
    state.btn.classList.remove('btn-loading');
    state.btn.disabled = false;
    state.btn.innerHTML = state.orig;
}

// Apply translations to all elements with data-i18n attribute
function applyLanguage(lang) {
    if (lang) {
        currentLang = lang;
        localStorage.setItem('monitaqc_lang', lang);
    }
    // Set RTL for Arabic and Persian
    var isRTL = (currentLang === 'ar' || currentLang === 'fa');
    document.documentElement.dir = isRTL ? 'rtl' : 'ltr';

    // Update all data-i18n elements
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
        var key = el.getAttribute('data-i18n');
        var prefix = el.getAttribute('data-i18n-prefix') || '';
        el.textContent = prefix + t(key);
    });
    // Update all data-i18n-placeholder elements
    document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el) {
        el.placeholder = t(el.getAttribute('data-i18n-placeholder'));
    });
    // Update language selector display
    var langSelect = document.getElementById('lang-select');
    if (langSelect) langSelect.value = currentLang;
}
